#!/usr/bin/env sh

# Get the root directory of the git repository
REPO_ROOT=$(git rev-parse --show-toplevel)

echo "ğŸ§ª Running backend tests before commit..."

# Change to backend directory and run tests
cd "$REPO_ROOT/backend" && npm test

if [ $? -ne 0 ]; then
  echo "âŒ Backend tests failed! Commit aborted."
  echo "ğŸ’¡ If you're seeing '@jest/test-sequencer' error due to macOS sandbox:"
  echo "   Run: git commit --no-verify"
  echo "   CI will test properly on GitHub Actions."
  exit 1
fi

echo "âœ… Backend tests passed!"
echo ""
echo "ğŸ§ª Running frontend tests (warn-only mode)..."

# Change to frontend directory and run tests
cd "$REPO_ROOT/frontend" && npm test

if [ $? -ne 0 ]; then
  echo ""
  echo "âš ï¸  Frontend tests have failures, but allowing commit to proceed."
  echo "ğŸ’¡ GitHub Actions CI/CD will run full test suite."
  echo "ğŸ’¡ Check CI results after pushing to catch any real issues."
  echo ""
else
  echo "âœ… Frontend tests passed!"
fi

echo "âœ… Proceeding with commit..."
